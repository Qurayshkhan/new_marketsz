import{C as te,q as c,g as a,o as n,a as g,d as E,h as se,w as C,b as e,n as O,F as f,r as x,t as r,T as le,i as y,f as _,e as oe,H as q,y as ae}from"./app-XwLTOkYq.js";import ne from"./Report-AmTsy0hQ.js";import{_ as re}from"./TextInput-Dbm7A6Ce.js";import{D as ie}from"./DangerButton-B8wI7WDS.js";import{_ as G}from"./Modal-Dkz40j4j.js";import{C as de}from"./CurrencyDollarText-BlEhlbln.js";import{_ as ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./AuthenticatedLayout-z4Gp56EV.js";const ce={class:"grid grid-cols-12 gap-4"},pe={class:"col-span-9"},ve={class:"w-full border text-center data-table text-sm"},ge={class:"uppercase bg-gray-100"},fe=["onClick"],ye=["onClick"],he={key:0,class:"bg-gray-50"},me={colspan:"5",class:"text-left px-5"},_e={class:"w-full my-5"},be={class:"flex items-center justify-between"},xe={class:"flex flex-col items-start"},ke=["onClick"],we={class:"text-lg"},Ce={class:"text-md text-gray-600"},Se={key:0,class:"text-sm"},Pe={colspan:"5"},Re={class:"flex items-center justify-between"},De={colspan:"5"},Fe={class:"my-2 w-full"},Ie={key:0},qe={class:"my-2 flex gap-2 items-center"},Te={class:""},Ue={class:"text-red-500"},Ae={colspan:"5"},Me={class:"flex items-center justify-between w-full"},$e={class:"w-full"},je={class:"relative w-full max-w-md"},Ne={class:"block truncate"},Ve={key:0,class:"absolute z-10 mt-1 w-full bg-white shadow-lg max-h-60 rounded-md py-1 text-sm ring-1 ring-black ring-opacity-5 overflow-auto"},ze=["onClick"],Be={class:"flex justify-between font-medium"},Ee={class:"text-primary-500 fw-bold"},Oe={class:"text-primary-600"},Ge={class:"text-gray-500 text-xs mt-1"},Le={key:0,class:"py-2"},Je={class:"bold"},We={class:"text-primary-800"},He=["disabled","onClick"],Qe={class:"col-span-3 bg-gray-50 p-4 rounded"},Ye={class:"p-6 space-y-4"},Ke={key:0,class:"mt-4"},Xe={class:"list-disc pl-5 text-sm text-gray-700 space-y-1"},Ze={class:"grid grid-cols-2 md:grid-cols-3 gap-4 mt-4"},et=["src"],tt=["onClick"],st={key:1,class:"p-4 text-sm text-gray-500 bg-gray-100 border rounded"},lt=["onClick"],ot={class:"flex justify-end gap-2"},at={class:"p-6 space-y-4"},nt={key:0,class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"},rt=["src"],it={key:1,class:"text-center text-gray-900"},dt={__name:"ActionRequired",props:{actions:Object,specialRequests:Object,packageCounts:Array},setup(L){const i=L,h=te(),S=i.actions,v=c(new Set),M=c(null),P=c(!1),R=c(!1),T=c(!1),U=c(!1),k=c(null),m=c([]),$=c(null),A=c(!1),D=c([]),w=c([]),J=o=>{v.value.has(o)?v.value.delete(o):v.value.add(o)},W=()=>{v.value.size===S.length?v.value.clear():v.value=new Set(S.map(o=>o.id))},H=()=>v.value.size===S.length,j=()=>{P.value=!P.value},Q=(o,t)=>{M.value=o;try{const d=q.post(route("customer.packageSetSpecialRequest"),{package_id:t,special_request:o.id});h.success(d.message||"Special request added successfully.")}catch(d){h.error(d)}finally{P.value=!1}},N=()=>{R.value=!R.value},b=()=>{T.value=!1,U.value=!1,m.value=[],D.value=[]},V=o=>{$.value=o,T.value=!0},Y=o=>{const t=Array.from(o.target.files);m.value=t,w.value=[],t.forEach(d=>{if(d.type.startsWith("image/")){const p=new FileReader;p.onload=F=>{w.value.push(F.target.result)},p.readAsDataURL(d)}else w.value.push(null)})},z=o=>{m.value.splice(o,1),w.value.splice(o,1)},K=async()=>{var t,d;A.value=!0;const o=new FormData;m.value.forEach(p=>o.append("invoices[]",p)),o.append("package_id",$.value),o.append("status",2);try{const p=await q.post(route("customers.packageUploadInvoices"),o,{headers:{"Content-Type":"multipart/form-data"}});h.success(p.data.message||"Invoices uploaded successfully"),b(),ae.visit(route("customer.suite.inReview"))}catch(p){h.error(((d=(t=p.response)==null?void 0:t.data)==null?void 0:d.message)||"Failed to upload invoices")}finally{A.value=!1}close()},X=async(o,t)=>{o.preventDefault();try{const d=await q.post(route("customer.packageAddNote"),{note:k.value,id:t});R.value=!1,h.success(d.data.message)}catch{h.error(response.data.message)}},Z=async o=>{try{const t=await q.get(route("customers.packageGetPhotos",{package_id:o}));D.value=t.data.data||[],U.value=!0}catch{h.error("Failed to fetch photos")}};return(o,t)=>{var d,p,F;return n(),a(f,null,[g(E(se),{title:"Action Required"}),g(ne,{actionCount:i==null?void 0:i.packageCounts.action_required,inReviewCount:(d=i==null?void 0:i.packageCounts)==null?void 0:d.in_review,readyToSendCount:(p=i==null?void 0:i.packageCounts)==null?void 0:p.ready_to_send,allPackagesCount:(F=i==null?void 0:i.packageCounts)==null?void 0:F.all},{default:C(()=>[e("div",ce,[e("div",pe,[e("table",ve,[e("thead",ge,[e("tr",null,[e("th",null,[e("i",{onClick:W,class:O(["cursor-pointer",["fa-solid",H()?"fa-angles-down":"fa-angles-right","text-primary-500"]])},null,2)]),t[6]||(t[6]=e("th",null,"From",-1)),t[7]||(t[7]=e("th",null,"Package ID",-1)),t[8]||(t[8]=e("th",null,"Date Received",-1)),t[9]||(t[9]=e("th",{class:"bg-primary-500 text-white"}," Action Required ",-1))])]),e("tbody",null,[(n(!0),a(f,null,x(E(S),l=>(n(),a(f,{key:l.id},[e("tr",null,[e("td",{onClick:u=>J(l.id),class:"cursor-pointer"},[e("i",{class:O(["fas",v.value.has(l.id)?"fa-chevron-down":"fa-chevron-right","text-primary-500"])},null,2)],8,fe),e("td",null,r(l.from),1),e("td",null,r(l.package_id),1),e("td",null,r(o.__format_date_time(l.date_received)),1),e("td",null,[e("div",null,[e("button",{class:"text-primary-500",onClick:u=>V(l.id)}," Upload Merchant Invoice ",8,ye),t[10]||(t[10]=e("p",null,"As required by Customs",-1))])])]),g(le,{name:"fade"},{default:C(()=>{var u,I,B;return[v.value.has(l.id)?(n(),a("tr",he,[e("td",me,[t[24]||(t[24]=e("div",null,[e("strong",null,"Upload Merchant Invoice"),e("p",{class:"text-sm text-gray-600"}," Please upload the merchant invoice for this package. When your invoice is successfully uploaded, your package will be placed In Review until it is verified by Marketsz "),e("hr")],-1)),e("table",_e,[e("thead",null,[e("th",null,[e("div",be,[e("div",xe,[t[11]||(t[11]=e("p",null," Package Details ",-1)),e("p",null," To: "+r((u=l==null?void 0:l.customer)==null?void 0:u.name),1)]),e("div",null,[e("button",{class:"btn bg-white text-black",onClick:s=>Z(l.id)}," Photo ",8,ke)])])]),t[12]||(t[12]=e("th",null,"Qty",-1)),t[13]||(t[13]=e("th",null,"Value Per Unit (USD)",-1)),t[14]||(t[14]=e("th",null,"Total Line Value (USD)",-1))]),e("tbody",null,[(n(!0),a(f,null,x(l.items,s=>(n(),a("tr",{key:s.id,class:"border bg-[#e8e7e7]"},[e("td",null,[e("p",we,r(s==null?void 0:s.title),1),e("p",Ce,r(s==null?void 0:s.description),1),s!=null&&s.item_note?(n(),a("p",Se,r(s==null?void 0:s.item_note),1)):y("",!0)]),e("td",null,r(s==null?void 0:s.quantity),1),e("td",null,r(s==null?void 0:s.value_per_unit),1),e("td",null,r(s==null?void 0:s.total_line_value),1)]))),128)),e("tr",null,[e("td",Pe,[e("div",Re,[e("p",null,[t[15]||(t[15]=e("span",{class:"uppercase"},"Total weight: ",-1)),_(r(l==null?void 0:l.weight)+" lbs ",1)]),e("p",null,[t[16]||(t[16]=e("span",{class:"uppercase"},"Total value of this package: ",-1)),_(r(l.total_value)+" USD ",1)])])])]),e("tr",null,[e("td",De,[e("div",Fe,[e("a",{onClick:t[0]||(t[0]=s=>N()),href:"#",class:"text-red-700"},"Add your notes"),t[17]||(t[17]=_(" to this package, this is for your use only, Marketsz will not review this area. "))]),R.value?(n(),a("div",Ie,[g(re,{class:"w-full",placeholder:"Please add note here",modelValue:k.value,"onUpdate:modelValue":t[1]||(t[1]=s=>k.value=s)},null,8,["modelValue"]),e("div",qe,[g(ie,{onClick:oe(s=>X(s,l.id),["prevent"])},{default:C(()=>t[18]||(t[18]=[_(" Save your note ")])),_:2,__:[18]},1032,["onClick"]),e("a",{onClick:t[2]||(t[2]=s=>N()),href:"javascript:void(0)"},"Cancel")])])):y("",!0),e("p",Te,[t[19]||(t[19]=_(" Note: ")),e("span",Ue,r(k.value?k.value:l==null?void 0:l.note),1)]),t[20]||(t[20]=e("hr",null,null,-1))])]),e("tr",null,[e("td",Ae,[e("div",Me,[e("div",$e,[t[23]||(t[23]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Optional Services",-1)),e("div",je,[e("button",{type:"button",class:"w-full border border-gray-300 bg-white rounded-md shadow-sm pl-4 pr-10 py-2 text-left cursor-pointer focus:outline-none focus:ring-1 focus:ring-primary-500 focus:border-primary-500 text-sm",onClick:t[3]||(t[3]=(...s)=>j&&j(...s))},[e("span",Ne,r(((I=M.value)==null?void 0:I.title)||"Select Optional Service"),1),t[21]||(t[21]=e("span",{class:"absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none"},[e("i",{class:"fa fa-chevron-down text-gray-400"})],-1))]),P.value?(n(),a("ul",Ve,[(n(!0),a(f,null,x(i==null?void 0:i.specialRequests,(s,ee)=>(n(),a("li",{key:ee,class:"px-4 py-2 hover:bg-gray-100 cursor-pointer",onClick:ut=>Q(s,l.id)},[e("div",Be,[e("span",Ee,r(s.title),1),e("span",Oe,"$"+r(s.price),1)]),e("p",Ge,r(s.description),1)],8,ze))),128))])):y("",!0)]),l.special_request?(n(),a("div",Le,[e("p",Je,[t[22]||(t[22]=_(" Your current special request is: ")),e("span",We,r(((B=l.special_request)==null?void 0:B.title)??""),1)])])):y("",!0)]),e("button",{disabled:A.value,type:"button",class:"btn btn-big mt-4 bg-primary-600 text-white hover:bg-primary-700 disabled:bg-primary-400",onClick:s=>V(l.id)}," Upload Invoice ",8,He)])])])])])])])):y("",!0)]}),_:2},1024)],64))),128))])])]),e("div",Qe,[g(de)])])]),_:1},8,["actionCount","inReviewCount","readyToSendCount","allPackagesCount"]),g(G,{show:T.value,onClose:b},{default:C(()=>[e("div",Ye,[e("div",{class:"flex justify-between items-center"},[t[25]||(t[25]=e("h2",{class:"text-lg font-semibold text-gray-900"}," Upload Merchant Invoice ",-1)),e("button",{onClick:b,class:"text-gray-500 hover:text-gray-800"}," Close ")]),e("div",null,[e("input",{type:"file",multiple:"",onChange:t[4]||(t[4]=l=>Y(l)),accept:".bmp, .jpg, .jpeg, .gif, .tif, .tiff, .pdf"},null,32),t[26]||(t[26]=e("p",{class:"text-sm text-gray-600 mt-1"}," Accepted File Types: BMP, JPG, JPEG, GIF, TIF, TIFF, PDF ",-1)),t[27]||(t[27]=e("p",{class:"text-sm text-gray-600"},"Max File Size: 2MB",-1))]),m.value.length?(n(),a("div",Ke,[t[28]||(t[28]=e("p",{class:"font-medium text-sm mb-1"},"Selected Files:",-1)),e("ul",Xe,[(n(!0),a(f,null,x(m.value,(l,u)=>(n(),a("li",{key:u},r(l.name),1))),128))])])):y("",!0),e("div",Ze,[(n(!0),a(f,null,x(w.value,(l,u)=>(n(),a("div",{key:u,class:"relative group"},[l?(n(),a("img",{key:0,src:l,alt:"Preview",class:"w-full h-auto border rounded shadow"},null,8,et)):y("",!0),e("button",{onClick:I=>z(u),class:"absolute top-1 right-1 bg-white text-red-500 border border-red-300 rounded-full p-1 text-xs opacity-80 group-hover:opacity-100 hover:bg-red-100",title:"Remove"}," ❌ ",8,tt),l?y("",!0):(n(),a("div",st,[_(r(m.value[u].type)+" preview not supported. ",1),e("button",{onClick:I=>z(u),class:"ml-2 text-red-500 underline text-xs"}," Remove ",8,lt)]))]))),128))]),e("div",ot,[e("button",{onClick:t[5]||(t[5]=l=>b()),class:"px-4 py-2 text-sm text-gray-700 border"}," Cancel "),e("button",{onClick:K,class:"px-4 py-2 text-sm bg-primary-600 text-white"}," Upload Document ")])])]),_:1},8,["show"]),g(G,{show:U.value,onClose:b},{default:C(()=>[e("div",at,[e("div",{class:"flex justify-between items-center"},[t[29]||(t[29]=e("h2",{class:"text-lg font-semibold text-gray-900"}," Package Photos ",-1)),e("button",{onClick:b,class:"text-gray-500 hover:text-gray-800"}," Close ")]),D.value.length>0?(n(),a("div",nt,[(n(!0),a(f,null,x(D.value,(l,u)=>(n(),a("img",{key:u,src:l.file_with_url,alt:"Package Photo",class:"rounded shadow border"},null,8,rt))),128))])):(n(),a("div",it,t[30]||(t[30]=[e("h3",null,"No photos available",-1)])))])]),_:1},8,["show"])],64)}}},_t=ue(dt,[["__scopeId","data-v-a41b67e6"]]);export{_t as default};
