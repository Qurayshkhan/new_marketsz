import{s as te,x as c,g as a,o as n,a as m,d as E,h as se,w as C,b as e,n as O,F as g,r as x,t as r,T as le,i as f,f as _,e as oe,y as U}from"./app-DIGk4C9T.js";import ae from"./Report-Q0HvzJf8.js";import{_ as ne}from"./TextInput-Pa75rfcU.js";import{D as re,_ as G}from"./Modal-DOKRdIOV.js";import{_ as de}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./AuthenticatedLayout-DAVkTewL.js";const ie={class:"grid grid-cols-12 gap-4"},ue={class:"col-span-9"},ce={class:"w-full border text-center data-table text-sm"},pe={class:"uppercase bg-gray-100"},ve=["onClick"],ge=["onClick"],fe={key:0,class:"bg-gray-50"},ye={colspan:"5",class:"text-left px-5"},he={class:"w-full my-5"},me={class:"flex items-center justify-between"},_e={class:"flex flex-col items-start"},be=["onClick"],xe={class:"text-lg"},ke={class:"text-md text-gray-600"},we={key:0,class:"text-sm"},Ce={colspan:"5"},Se={class:"flex items-center justify-between"},Pe={colspan:"5"},De={class:"my-2 w-full"},Fe={key:0},Ie={class:"my-2 flex gap-2 items-center"},Re={class:""},Ue={class:"text-red-500"},qe={colspan:"5"},Te={class:"flex items-center justify-between w-full"},Ae={class:"w-full"},$e={class:"relative w-full max-w-md"},Me={class:"block truncate"},je={key:0,class:"absolute z-10 mt-1 w-full bg-white shadow-lg max-h-60 rounded-md py-1 text-sm ring-1 ring-black ring-opacity-5 overflow-auto"},Ne=["onClick"],Ve={class:"flex justify-between font-medium"},ze={class:"text-primary-500 fw-bold"},Be={class:"text-primary-600"},Ee={class:"text-gray-500 text-xs mt-1"},Oe={key:0,class:"py-2"},Ge={class:"bold"},Le={class:"text-primary-800"},Je=["disabled","onClick"],We={class:"p-6 space-y-4"},Qe={key:0,class:"mt-4"},Ye={class:"list-disc pl-5 text-sm text-gray-700 space-y-1"},He={class:"grid grid-cols-2 md:grid-cols-3 gap-4 mt-4"},Ke=["src"],Xe=["onClick"],Ze={key:1,class:"p-4 text-sm text-gray-500 bg-gray-100 border rounded"},et=["onClick"],tt={class:"flex justify-end gap-2"},st={class:"p-6 space-y-4"},lt={key:0,class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"},ot=["src"],at={key:1,class:"text-center text-gray-900"},nt={__name:"ActionRequired",props:{actions:Object,specialRequests:Object,packageCounts:Array},setup(L){const d=L,y=te(),S=d.actions,v=c(new Set),$=c(null),P=c(!1),D=c(!1),q=c(!1),T=c(!1),k=c(null),h=c([]),M=c(null),A=c(!1),F=c([]),w=c([]),J=o=>{v.value.has(o)?v.value.delete(o):v.value.add(o)},W=()=>{v.value.size===S.length?v.value.clear():v.value=new Set(S.map(o=>o.id))},Q=()=>v.value.size===S.length,j=()=>{P.value=!P.value},Y=(o,t)=>{$.value=o;try{const i=U.post(route("customer.packageSetSpecialRequest"),{package_id:t,special_request:o.id});y.success(i.message||"Special request added successfully.")}catch(i){y.error(i)}finally{P.value=!1}},N=()=>{D.value=!D.value},b=()=>{q.value=!1,T.value=!1,h.value=[],F.value=[]},V=o=>{M.value=o,q.value=!0},H=o=>{const t=Array.from(o.target.files);h.value=t,w.value=[],t.forEach(i=>{if(i.type.startsWith("image/")){const p=new FileReader;p.onload=I=>{w.value.push(I.target.result)},p.readAsDataURL(i)}else w.value.push(null)})},z=o=>{h.value.splice(o,1),w.value.splice(o,1)},K=async()=>{var t,i;A.value=!0;const o=new FormData;h.value.forEach(p=>o.append("invoices[]",p)),o.append("package_id",M.value),o.append("status",2);try{const p=await U.post(route("customers.packageUploadInvoices"),o,{headers:{"Content-Type":"multipart/form-data"}});y.success(p.data.message||"Invoices uploaded successfully"),b(),setTimeout(()=>{window.location.reload()},1e3)}catch(p){y.error(((i=(t=p.response)==null?void 0:t.data)==null?void 0:i.message)||"Failed to upload invoices")}finally{A.value=!1}close()},X=async(o,t)=>{o.preventDefault();try{const i=await U.post(route("customer.packageAddNote"),{note:k.value,id:t});D.value=!1,y.success(i.data.message)}catch{y.error(response.data.message)}},Z=async o=>{try{const t=await U.get(route("customers.packageGetPhotos",{package_id:o}));F.value=t.data.data||[],T.value=!0}catch{y.error("Failed to fetch photos")}};return(o,t)=>{var i,p,I;return n(),a(g,null,[m(E(se),{title:"Action Required"}),m(ae,{actionCount:d==null?void 0:d.packageCounts.action_required,inReviewCount:(i=d==null?void 0:d.packageCounts)==null?void 0:i.in_review,readyToSendCount:(p=d==null?void 0:d.packageCounts)==null?void 0:p.ready_to_send,allPackagesCount:(I=d==null?void 0:d.packageCounts)==null?void 0:I.all},{default:C(()=>[e("div",ie,[e("div",ue,[e("table",ce,[e("thead",pe,[e("tr",null,[e("th",null,[e("i",{onClick:W,class:O(["cursor-pointer",["fa-solid",Q()?"fa-angles-down":"fa-angles-right","text-primary-500"]])},null,2)]),t[6]||(t[6]=e("th",null,"From",-1)),t[7]||(t[7]=e("th",null,"Package ID",-1)),t[8]||(t[8]=e("th",null,"Date Received",-1)),t[9]||(t[9]=e("th",{class:"bg-primary-500 text-white"}," Action Required ",-1))])]),e("tbody",null,[(n(!0),a(g,null,x(E(S),l=>(n(),a(g,{key:l.id},[e("tr",null,[e("td",{onClick:u=>J(l.id),class:"cursor-pointer"},[e("i",{class:O(["fas",v.value.has(l.id)?"fa-chevron-down":"fa-chevron-right","text-primary-500"])},null,2)],8,ve),e("td",null,r(l.from),1),e("td",null,r(l.package_id),1),e("td",null,r(o.__format_date_time(l.date_received)),1),e("td",null,[e("div",null,[e("button",{class:"text-primary-500",onClick:u=>V(l.id)}," Upload Merchant Invoice ",8,ge),t[10]||(t[10]=e("p",null,"As required by Customs",-1))])])]),m(le,{name:"fade"},{default:C(()=>{var u,R,B;return[v.value.has(l.id)?(n(),a("tr",fe,[e("td",ye,[t[24]||(t[24]=e("div",null,[e("strong",null,"Upload Merchant Invoice"),e("p",{class:"text-sm text-gray-600"}," Please upload the merchant invoice for this package. When your invoice is successfully uploaded, your package will be placed In Review until it is verified by Marketsz "),e("hr")],-1)),e("table",he,[e("thead",null,[e("th",null,[e("div",me,[e("div",_e,[t[11]||(t[11]=e("p",null," Package Details ",-1)),e("p",null," To: "+r((u=l==null?void 0:l.customer)==null?void 0:u.name),1)]),e("div",null,[e("button",{class:"btn bg-white text-black",onClick:s=>Z(l.id)}," Photo ",8,be)])])]),t[12]||(t[12]=e("th",null,"Qty",-1)),t[13]||(t[13]=e("th",null,"Value Per Unit (USD)",-1)),t[14]||(t[14]=e("th",null,"Total Line Value (USD)",-1))]),e("tbody",null,[(n(!0),a(g,null,x(l.items,s=>(n(),a("tr",{key:s.id,class:"border bg-[#e8e7e7]"},[e("td",null,[e("p",xe,r(s==null?void 0:s.title),1),e("p",ke,r(s==null?void 0:s.description),1),s!=null&&s.item_note?(n(),a("p",we,r(s==null?void 0:s.item_note),1)):f("",!0)]),e("td",null,r(s==null?void 0:s.quantity),1),e("td",null,r(s==null?void 0:s.value_per_unit),1),e("td",null,r(s==null?void 0:s.total_line_value),1)]))),128)),e("tr",null,[e("td",Ce,[e("div",Se,[e("p",null,[t[15]||(t[15]=e("span",{class:"uppercase"},"Total weight: ",-1)),_(r(l==null?void 0:l.weight)+" lbs ",1)]),e("p",null,[t[16]||(t[16]=e("span",{class:"uppercase"},"Total value of this package: ",-1)),_(r(l.total_value)+" USD ",1)])])])]),e("tr",null,[e("td",Pe,[e("div",De,[e("a",{onClick:t[0]||(t[0]=s=>N()),href:"#",class:"text-red-700"},"Add your notes"),t[17]||(t[17]=_(" to this package, this is for your use only, Marketsz will not review this area. "))]),D.value?(n(),a("div",Fe,[m(ne,{class:"w-full",placeholder:"Please add note here",modelValue:k.value,"onUpdate:modelValue":t[1]||(t[1]=s=>k.value=s)},null,8,["modelValue"]),e("div",Ie,[m(re,{onClick:oe(s=>X(s,l.id),["prevent"])},{default:C(()=>t[18]||(t[18]=[_(" Save your note ")])),_:2,__:[18]},1032,["onClick"]),e("a",{onClick:t[2]||(t[2]=s=>N()),href:"javascript:void(0)"},"Cancel")])])):f("",!0),e("p",Re,[t[19]||(t[19]=_(" Note: ")),e("span",Ue,r(k.value?k.value:l==null?void 0:l.note),1)]),t[20]||(t[20]=e("hr",null,null,-1))])]),e("tr",null,[e("td",qe,[e("div",Te,[e("div",Ae,[t[23]||(t[23]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Optional Services",-1)),e("div",$e,[e("button",{type:"button",class:"w-full border border-gray-300 bg-white rounded-md shadow-sm pl-4 pr-10 py-2 text-left cursor-pointer focus:outline-none focus:ring-1 focus:ring-primary-500 focus:border-primary-500 text-sm",onClick:t[3]||(t[3]=(...s)=>j&&j(...s))},[e("span",Me,r(((R=$.value)==null?void 0:R.title)||"Select Optional Service"),1),t[21]||(t[21]=e("span",{class:"absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none"},[e("i",{class:"fa fa-chevron-down text-gray-400"})],-1))]),P.value?(n(),a("ul",je,[(n(!0),a(g,null,x(d==null?void 0:d.specialRequests,(s,ee)=>(n(),a("li",{key:ee,class:"px-4 py-2 hover:bg-gray-100 cursor-pointer",onClick:rt=>Y(s,l.id)},[e("div",Ve,[e("span",ze,r(s.title),1),e("span",Be,"$"+r(s.price),1)]),e("p",Ee,r(s.description),1)],8,Ne))),128))])):f("",!0)]),l.special_request?(n(),a("div",Oe,[e("p",Ge,[t[22]||(t[22]=_(" Your current special request is: ")),e("span",Le,r(((B=l.special_request)==null?void 0:B.title)??""),1)])])):f("",!0)]),e("button",{disabled:A.value,type:"button",class:"btn btn-big mt-4 bg-primary-600 text-white hover:bg-primary-700 disabled:bg-primary-400",onClick:s=>V(l.id)}," Upload Invoice ",8,Je)])])])])])])])):f("",!0)]}),_:2},1024)],64))),128))])])]),t[25]||(t[25]=e("div",{class:"col-span-3 bg-gray-50 p-4 rounded"},[e("p",null,"All values are in United States dollars (USD).")],-1))])]),_:1},8,["actionCount","inReviewCount","readyToSendCount","allPackagesCount"]),m(G,{show:q.value,onClose:b},{default:C(()=>[e("div",We,[e("div",{class:"flex justify-between items-center"},[t[26]||(t[26]=e("h2",{class:"text-lg font-semibold text-gray-900"}," Upload Merchant Invoice ",-1)),e("button",{onClick:b,class:"text-gray-500 hover:text-gray-800"}," Close ")]),e("div",null,[e("input",{type:"file",multiple:"",onChange:t[4]||(t[4]=l=>H(l)),accept:".bmp, .jpg, .jpeg, .gif, .tif, .tiff, .pdf"},null,32),t[27]||(t[27]=e("p",{class:"text-sm text-gray-600 mt-1"}," Accepted File Types: BMP, JPG, JPEG, GIF, TIF, TIFF, PDF ",-1)),t[28]||(t[28]=e("p",{class:"text-sm text-gray-600"},"Max File Size: 2MB",-1))]),h.value.length?(n(),a("div",Qe,[t[29]||(t[29]=e("p",{class:"font-medium text-sm mb-1"},"Selected Files:",-1)),e("ul",Ye,[(n(!0),a(g,null,x(h.value,(l,u)=>(n(),a("li",{key:u},r(l.name),1))),128))])])):f("",!0),e("div",He,[(n(!0),a(g,null,x(w.value,(l,u)=>(n(),a("div",{key:u,class:"relative group"},[l?(n(),a("img",{key:0,src:l,alt:"Preview",class:"w-full h-auto border rounded shadow"},null,8,Ke)):f("",!0),e("button",{onClick:R=>z(u),class:"absolute top-1 right-1 bg-white text-red-500 border border-red-300 rounded-full p-1 text-xs opacity-80 group-hover:opacity-100 hover:bg-red-100",title:"Remove"}," ❌ ",8,Xe),l?f("",!0):(n(),a("div",Ze,[_(r(h.value[u].type)+" preview not supported. ",1),e("button",{onClick:R=>z(u),class:"ml-2 text-red-500 underline text-xs"}," Remove ",8,et)]))]))),128))]),e("div",tt,[e("button",{onClick:t[5]||(t[5]=l=>b()),class:"px-4 py-2 text-sm text-gray-700 border"}," Cancel "),e("button",{onClick:K,class:"px-4 py-2 text-sm bg-primary-600 text-white"}," Upload Document ")])])]),_:1},8,["show"]),m(G,{show:T.value,onClose:b},{default:C(()=>[e("div",st,[e("div",{class:"flex justify-between items-center"},[t[30]||(t[30]=e("h2",{class:"text-lg font-semibold text-gray-900"}," Package Photos ",-1)),e("button",{onClick:b,class:"text-gray-500 hover:text-gray-800"}," Close ")]),F.value.length>0?(n(),a("div",lt,[(n(!0),a(g,null,x(F.value,(l,u)=>(n(),a("img",{key:u,src:l.file_with_url,alt:"Package Photo",class:"rounded shadow border"},null,8,ot))),128))])):(n(),a("div",at,t[31]||(t[31]=[e("h3",null,"No photos available",-1)])))])]),_:1},8,["show"])],64)}}},gt=de(nt,[["__scopeId","data-v-7b27f982"]]);export{gt as default};
